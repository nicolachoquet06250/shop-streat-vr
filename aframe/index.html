<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Boutique générique VR</title>
    <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.js"></script>
    <script src="https://unpkg.com/aframe-physics-system@1.4.0/dist/aframe-physics-system.js"></script>
    <script src="https://unpkg.com/super-hands@2.0.2/dist/super-hands.min.js"></script>

    <script>
	    /*AFRAME.registerComponent('toggle', {
		    schema: {
			    hover: {default: 'onHover'},
			    out: {default: 'onOut'}
		    },

            getData: function() {
		    	return this.data;
            },

            getElem() {
		    	return this.el;
            },

		    init: function () {
		    	var data = this.data;
			    var el = this.el;

		    	var callbacks = {
				    onHover: function () {
					    el.setAttribute('color', 'blue');
					    el.addEventListener('click', () => {
					    	el.setAttribute('visible', !el.setAttribute('visible'));
                        });
					    document.querySelector('#right').addEventListener('abuttondown', function (evt) {
						    document.querySelector('#txt').setAttribute('value', 'A - ' + evt.detail.body.el.tagName);
						    evt.detail.body.el.setAttribute('visible', evt.detail.body.el.getAttribute('visible'));
					    });
					    document.querySelector('#left').addEventListener('gripdown', function (evt) {
						    document.querySelector('#txt').setAttribute('value', 'GRIP - ' + evt.detail.body.el.tagName);
						    evt.detail.body.el.setAttribute('visible', evt.detail.body.el.getAttribute('visible'));
					    });
				    },
				    onOut: function () {
					    el.setAttribute('color', 'white');
					    el.removeEventListener('click', () => {
						    el.setAttribute('visible', !el.setAttribute('visible'));
					    });
					    document.querySelector('#right').removeEventListener('abuttondown', function (evt) {
						    document.querySelector('#txt').setAttribute('value', 'A - ' + evt.detail.body.el.tagName);
						    evt.detail.body.el.setAttribute('visible', evt.detail.body.el.getAttribute('visible'));
					    });
					    document.querySelector('#left').removeEventListener('gripdown', function (evt) {
						    document.querySelector('#txt').setAttribute('value', 'GRIP - ' + evt.detail.body.el.tagName);
						    evt.detail.body.el.setAttribute('visible', evt.detail.body.el.getAttribute('visible'));
					    });
				    }
                };

			    if(data.hover in callbacks) {
				    el.addEventListener('mouseenter', callbacks[data.hover]);
			    }
			    if(data.out in callbacks) {
				    el.addEventListener('mouseleave', callbacks[data.out]);
			    }
		    }
	    });*/

	    AFRAME.registerComponent('toggle', {
		    schema: {
			    hover: {default: 'onHover'},
			    out: {default: 'onOut'}
		    },

		    getData: function() {
			    return this.data;
		    },

		    getElem() {
			    return this.el;
		    },

		    init: function () {
			    var data = this.data;
			    var el = this.el;

			    var callbacks = {
				    onHover: function () {
					    el.setAttribute('color', 'blue');
					    document.querySelector('#right').addEventListener('abuttondown', function (evt) {
						    el.setAttribute('visible', !el.getAttribute('visible'));
					    });
					    document.querySelector('#left').addEventListener('xbuttondown', function (evt) {
						    el.setAttribute('visible', !el.getAttribute('visible'));
					    });
                        document.querySelector('#right').addEventListener('gripdown', function (evt) {
	                        el.setAttribute('visible', !el.getAttribute('visible'));
                        });
					    document.querySelector('#left').addEventListener('gripdown', function (evt) {
						    el.setAttribute('visible', !el.getAttribute('visible'));
					    });
				    },
				    onOut: function () {
					    el.setAttribute('color', 'white');
				    }
			    };

			    if(data.hover in callbacks) {
				    el.addEventListener('mouseenter', callbacks[data.hover]);
			    }
			    if(data.out in callbacks) {
				    el.addEventListener('mouseleave', callbacks[data.out]);
			    }
		    }
	    });

	    /*AFRAME.registerComponent('a-button-listener', {
		    init: function () {
			    var el = this.el;
			    el.addEventListener('abuttondown', function (evt) {
				    el.setAttribute('visible', !el.getAttribute('visible'));
			    });
		    }
	    });

	    AFRAME.registerComponent('grip-down', {
		    init: function () {
			    var el = this.el;
			    el.addEventListener('gripdown', function (evt) {
				    el.setAttribute('visible', !el.getAttribute('visible'));
			    });
		    }
	    });*/
    </script>
</head>
<body>
    <a-scene physics="friction: 0.1; restitution: 0.5; debug: true">
        <a-assets>
            <a-asset-item id="cloud" src="../models/nuage.obj"></a-asset-item>
        </a-assets>

        <!--
            position: x y z
            rotation: x y z
            width: largeur
            height: hauteur
            depth: profondeur
        -->

        <!-- element collisionné: evt.detail.body.el -->

        <a-box class="building" position="-49.5 3 -52" rotation="0 -90 0" width="2" height="6" toggle collide static-body></a-box>
        <a-box class="building" position="-49 6 -53.5" width="2" height="12" depth="1" toggle collide static-body></a-box>
        <a-box class="building" position="-47 3 -53.5" width="2" height="6" depth="1" toggle collide static-body></a-box>
        <a-box class="building" position="-45 1 -53.5" width="2" height="2" depth="1" toggle collide static-body></a-box>
        <a-box class="building" position="-43 1.5 -53.5" width="2" height="3" depth="1" toggle collide static-body></a-box>
        <a-box class="building" position="-39 3 -53.5" width="6" height="6" depth="1" toggle collide static-body></a-box>

        <a-light type="ambient" color="#445451"></a-light>
        <a-light type="point" intensity="2" position="2 4 4"></a-light>

        <a-entity obj-model="obj: #cloud" position="-50 10 -50" scale="20 0 10" color="white"></a-entity>
        <a-entity obj-model="obj: #cloud" position="-40 10 -60" scale="20 0 10" color="white"></a-entity>
        <a-entity class="sol" environment="shadow: true; shadowSize: 10;" toogle></a-entity>

        <a-entity id="player">
            <a-camera id="camera" position="-40 1.6 -50" universal-controls kinematic-body>
                <a-entity cursor="type: gaze" visible="false"></a-entity>
            </a-camera>
            <a-entity id="left"
                      hand-controls="left"
                      rotation="-90 0 0"
                      raycaster="objects: .building, .sol"
                      super-hands laser-controls cursor></a-entity>
            <a-entity id="right"
                      hand-controls="right"
                      rotation="90 0 0"
                      raycaster="objects: .building, .sol"
                      super-hands laser-controls cursor></a-entity>
        </a-entity>
    </a-scene>
</body>
</html>

<!--<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Oculus Quest Input</title>
    <meta name="description" content="Oculus Quest Input">
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
</head>
<body>
<a-scene background="color: #FAFAFA">
    <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9" shadow></a-box>
    <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E" shadow></a-sphere>
    <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D" shadow></a-cylinder>
    <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4" shadow></a-plane>
    <a-entity id="ctlL" laser-controls="hand: left"></a-entity>
    <a-entity id="ctlR" laser-controls="hand: right"></a-entity>
    <a-entity camera look-controls position="0 1.6 0">
        <a-text id="txt" value="" position="0 0 -1" scale="0.4 0.4 0.4" align="center" color="#000000"></a-text>
        <a-text id="txt2" value="" position="0 -0.15 -1" scale="0.4 0.4 0.4" align="center" color="#000000"></a-text>
    </a-entity>
</a-scene>

<script>
	const ctlL = document.getElementById("ctlL");
	const ctlR = document.getElementById("ctlR");
	const txt = document.getElementById("txt");
	const txt2 = document.getElementById("txt2");

	//Getting Position of Right Controller.
	const timer = setInterval(() => {
		var p=ctlR.object3D.position;
		txt2.setAttribute("value","R-Position: "+ p.x.toFixed(2)+", "+p.y.toFixed(2)+", "+p.z.toFixed(2));
	}, 100);

	//Stick Moved
	ctlL.addEventListener('axismove',function(event){
		txt.setAttribute("value", "L Stick  x:"+event.detail.axis[0].toFixed(2)+", y:"+event.detail.axis[1].toFixed(2));
	});
	ctlR.addEventListener('axismove',function(event){
		txt.setAttribute("value", "R Stick  x:"+event.detail.axis[0].toFixed(2)+", y:"+event.detail.axis[1].toFixed(2));
	});

	//Trigger Touch Started
	ctlL.addEventListener('triggertouchstart', function (event) {
		txt.setAttribute("value","Left touch started ");
	});
	ctlR.addEventListener('triggertouchstart', function (event) {
		txt.setAttribute("value","Right touch started");
	});

	//Trigger Touch Ended
	ctlL.addEventListener('triggertouchend', function (event) {
		txt.setAttribute("value","Left touch ended ");
	});
	ctlR.addEventListener('triggertouchend', function (event) {
		txt.setAttribute("value","Right touch ended");
	});

	//Trigger Pressed
	ctlL.addEventListener('triggerdown', function (event) {
		txt.setAttribute("value","Left trigger down");
	});

	ctlR.addEventListener('triggerdown', function (event) {
		txt.setAttribute("value","Right trigger down");
	});

	//Trigger Released
	ctlL.addEventListener('triggerup', function (event) {
		txt.setAttribute("value","Left trigger up");
	});
	ctlR.addEventListener('triggerup', function (event) {
		txt.setAttribute("value","Right trigger up");
	});

	//Grip Pressed
	ctlL.addEventListener('gripdown', function (event) {
		txt.setAttribute("value","Left gripdown down");
	});
	ctlR.addEventListener('gripdown', function (event) {
		txt.setAttribute("value","Right gripdown down");
	});

	//Grip Released
	ctlL.addEventListener('gripup', function (event) {
		txt.setAttribute("value","Left gripdown up");
	});
	ctlR.addEventListener('gripup', function (event) {
		txt.setAttribute("value","Right gripdown up");
	});


	//A-buttorn Pressed
	ctlR.addEventListener('abuttondown', function (event) {
		txt.setAttribute("value","Right A-button down");
	});

	//A-buttorn Released
	ctlR.addEventListener('abuttonup', function (event) {
		txt.setAttribute("value","Right A-button up");
	});

	//B-buttorn Pressed
	ctlR.addEventListener('bbuttondown', function (event) {
		txt.setAttribute("value","Right B-button down");
	});

	//B-buttorn Released
	ctlR.addEventListener('bbuttonup', function (event) {
		txt.setAttribute("value","Right B-button up");
	});

	//Y-buttorn Pressed
	ctlL.addEventListener('ybuttondown', function (event) {
		txt.setAttribute("value","Left Y-button down");
	});

	//Y-buttorn Released
	ctlL.addEventListener('ybuttonup', function (event) {
		txt.setAttribute("value","Left Y-button up");
	});

	//X-buttorn Pressed
	ctlL.addEventListener('xbuttondown', function (event) {
		txt.setAttribute("value","Left X-button down");
	});

	//X-buttorn Released
	ctlL.addEventListener('xbuttonup', function (event) {
		txt.setAttribute("value","Left X-button up");
	});
</script>
</body>
</html>-->
